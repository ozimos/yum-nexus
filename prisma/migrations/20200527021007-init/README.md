# Migration `20200527021007-init`

This migration has been generated by Tovieye Moses Ozi at 5/27/2020, 2:10:07 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "yum_meals"."Address" (
"areaCode" integer  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"lga" text  NOT NULL ,"state" text  NOT NULL ,"street1" text  NOT NULL ,"street2" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "yum_meals"."DefaultAddress" (
"addressId" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "yum_meals"."Meal" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"deletedAt" timestamp(3)   ,"description" text  NOT NULL ,"id" text  NOT NULL ,"imageUrl" text  NOT NULL ,"price" integer  NOT NULL ,"tags" text []  ,"title" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "yum_meals"."MealsOnOrders" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"mealId" text  NOT NULL ,"orderId" text  NOT NULL ,"quantity" integer  NOT NULL DEFAULT 1,"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "yum_meals"."Menu" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"menuDate" timestamp(3)  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "yum_meals"."Order" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"status" "Status" NOT NULL DEFAULT 'PENDING',"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "yum_meals"."User" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"email" text  NOT NULL ,"firstName" text  NOT NULL ,"id" text  NOT NULL ,"lastName" text  NOT NULL ,"password" text  NOT NULL ,"role" "Role" NOT NULL DEFAULT 'USER',"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "yum_meals"."_MealMenu" (
"A" text  NOT NULL ,"B" text  NOT NULL )

CREATE UNIQUE INDEX "addressMine" ON "yum_meals"."Address"("id","userId")

CREATE UNIQUE INDEX "DefaultAddress.userId" ON "yum_meals"."DefaultAddress"("userId")

CREATE UNIQUE INDEX "mealMine" ON "yum_meals"."Meal"("id","userId")

CREATE UNIQUE INDEX "mealsOnOrders" ON "yum_meals"."MealsOnOrders"("mealId","orderId")

CREATE UNIQUE INDEX "menuMine" ON "yum_meals"."Menu"("menuDate","userId")

CREATE UNIQUE INDEX "orderMine" ON "yum_meals"."Order"("id","userId")

CREATE UNIQUE INDEX "User.email" ON "yum_meals"."User"("email")

CREATE UNIQUE INDEX "_MealMenu_AB_unique" ON "yum_meals"."_MealMenu"("A","B")

CREATE  INDEX "_MealMenu_B_index" ON "yum_meals"."_MealMenu"("B")

ALTER TABLE "yum_meals"."Address" ADD FOREIGN KEY ("userId")REFERENCES "yum_meals"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "yum_meals"."DefaultAddress" ADD FOREIGN KEY ("addressId", "userId")REFERENCES "yum_meals"."Address"("id","userId") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "yum_meals"."DefaultAddress" ADD FOREIGN KEY ("userId")REFERENCES "yum_meals"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "yum_meals"."Meal" ADD FOREIGN KEY ("userId")REFERENCES "yum_meals"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "yum_meals"."MealsOnOrders" ADD FOREIGN KEY ("mealId")REFERENCES "yum_meals"."Meal"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "yum_meals"."MealsOnOrders" ADD FOREIGN KEY ("orderId")REFERENCES "yum_meals"."Order"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "yum_meals"."Menu" ADD FOREIGN KEY ("userId")REFERENCES "yum_meals"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "yum_meals"."Order" ADD FOREIGN KEY ("userId")REFERENCES "yum_meals"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "yum_meals"."_MealMenu" ADD FOREIGN KEY ("A")REFERENCES "yum_meals"."Meal"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "yum_meals"."_MealMenu" ADD FOREIGN KEY ("B")REFERENCES "yum_meals"."Menu"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200527021007-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,117 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+model Address {
+  areaCode         Int
+  createdAt        DateTime         @default(now())
+  id               String           @default(cuid()) @id
+  lga              String
+  state            String
+  street1          String
+  street2          String
+  updatedAt        DateTime         @default(now())
+  userId           String
+  user             User             @relation(fields: [userId], references: [id])
+
+  @@unique([id, userId], name: "addressMine")
+}
+
+model DefaultAddress {
+  id        String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @default(now())
+  addressId String
+  address   Address  @relation(fields: [addressId, userId], references: [id, userId])
+  userId    String   @unique
+  user      User     @relation(fields: [userId], references: [id])
+}
+
+model Meal {
+  createdAt   DateTime        @default(now())
+  deletedAt   DateTime?
+  description String
+  id          String          @default(cuid()) @id
+  imageUrl    String
+  price       Int
+  tags        String[]
+  title       String
+  updatedAt   DateTime        @default(now())
+  userId      String
+  user        User            @relation(fields: [userId], references: [id])
+  orders      MealsOnOrders[]
+  menus       Menu[]          @relation("MealMenu", references: [id])
+
+  @@unique([id, userId], name: "mealMine")
+}
+
+model MealsOnOrders {
+  createdAt DateTime @default(now())
+  id        String   @default(cuid()) @id
+  mealId    String
+  orderId   String
+  quantity  Int      @default(1)
+  updatedAt DateTime @default(now())
+  meal      Meal     @relation(fields: [mealId], references: [id])
+  order     Order    @relation(fields: [orderId], references: [id])
+
+  @@unique([mealId, orderId], name: "mealsOnOrders")
+}
+
+model Menu {
+  createdAt DateTime @default(now())
+  id        String   @default(cuid()) @id
+  menuDate  DateTime
+  updatedAt DateTime @default(now())
+  userId    String
+  user      User     @relation(fields: [userId], references: [id])
+  meals     Meal[]   @relation("MealMenu", references: [id])
+
+  @@unique([menuDate, userId], name: "menuMine")
+}
+
+model Order {
+  createdAt DateTime        @default(now())
+  id        String          @default(cuid()) @id
+  status    Status          @default(PENDING)
+  updatedAt DateTime        @default(now())
+  userId    String
+  user      User            @relation(fields: [userId], references: [id])
+  meals     MealsOnOrders[]
+
+  @@unique([id, userId], name: "orderMine")
+}
+
+model User {
+  createdAt      DateTime        @default(now())
+  email          String          @unique
+  firstName      String
+  id             String          @default(cuid()) @id
+  lastName       String
+  password       String
+  role           Role            @default(USER)
+  updatedAt      DateTime        @default(now())
+  defaultAddress DefaultAddress?
+  addresses      Address[]
+  meals          Meal[]
+  menus          Menu[]
+  orders         Order[]
+}
+
+enum Role {
+  ADMIN
+  CATERER
+  USER
+}
+
+enum Status {
+  DISPATCHED
+  FULFILLED
+  PENDING
+  PROCESSING
+}
```
